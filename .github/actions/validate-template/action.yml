name: Validate template

description: Validate ADF template

inputs:
  path:
    required: true
    description: Project root
  directory:
    required: false
    description: Template directory

outputs:
  status:
    description: Validate status
    value: ${{ steps.validate-template.outputs.status }}
  detail:
    description: Validate detail
    value: ${{ steps.validate-template.outputs.detail }}

runs:
  using: composite
  steps:
    - name: Setup Deno environment
      uses: denoland/setup-deno@v1
      with:
        deno-version: v1.x

    - name: Validate template
      id: validate-template
      env:
        INPUT_PATH: ${{ inputs.path }}
        INPUT_DIRECTORY: ${{ inputs.directory }}
        ACTION_PATH: ${{ github.action_path }}
      shell: bash
      run: |
        result=$(deno run --allow-read "${ACTION_PATH}/src/main.ts" "${INPUT_PATH}" "${INPUT_DIRECTORY}")
        # Parse JSON and extract status and detail separately
        status=$(echo "$result" | jq -r '.status')
        detail=$(echo "$result" | jq -r '.detail')
        echo "status=${status}" >> "$GITHUB_OUTPUT"
        echo "detail=${detail}" >> "$GITHUB_OUTPUT"
