{"$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"factoryName":{"type":"string","metadata":"Data Factory name"},"SapHana1":{"type":"string"},"AzureDataLakeStorage1":{"type":"string"}},"variables":{"factoryId":"[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"},"resources":[{"name":"[concat(parameters('factoryName'), '/Copy multiple tables from SAP HANA to parquet')]","type":"Microsoft.DataFactory/factories/pipelines","apiVersion":"2018-06-01","properties":{"description":"Use this template to copy a list of tables from SAP HANA to Azure Data Lake Storage Gen 2 as parquet files. The list of tables is stored in the pipeline parameter \"SAPTables\" and can be modified after pipeline creation.","activities":[{"name":"For Each SAP Table","type":"ForEach","dependsOn":[],"userProperties":[],"typeProperties":{"items":{"value":"@pipeline().parameters.SAPTables","type":"Expression"},"isSequential":true,"activities":[{"name":"Copy table data from SAP to parquet","type":"Copy","dependsOn":[],"policy":{"timeout":"7.00:00:00","retry":0,"retryIntervalInSeconds":30,"secureOutput":false,"secureInput":false},"userProperties":[],"typeProperties":{"source":{"type":"SapHanaSource","partitionOption":"None"},"sink":{"type":"ParquetSink","storeSettings":{"type":"AzureBlobFSWriteSettings"},"formatSettings":{"type":"ParquetWriteSettings"}},"enableStaging":false,"translator":{"type":"TabularTranslator","typeConversion":true,"typeConversionSettings":{"allowDataTruncation":true,"treatBooleanAsNumber":false}}},"inputs":[{"referenceName":"SAPHanaTable","type":"DatasetReference","parameters":{"tableSchema":{"value":"@split(item(), '.')[0]","type":"Expression"},"tableName":{"value":"@split(item(), '.')[1]","type":"Expression"}}}],"outputs":[{"referenceName":"parquetOutput","type":"DatasetReference","parameters":{"tableName":{"value":"@split(item(), '.')[0]","type":"Expression"},"tableSchema":{"value":"@split(item(), '.')[1]","type":"Expression"},"fileSystem":{"value":"@pipeline().parameters.fileDirectory","type":"Expression"}}}]}]}}],"policy":{"elapsedTimeMetric":{},"cancelAfter":{}},"parameters":{"fileDirectory":{"type":"string","defaultValue":"templateOutput"},"SAPTables":{"type":"array","defaultValue":["SAPHANA.Table1","SAPHANA.Table2","SAPHANA.Table3"]}},"annotations":[]},"dependsOn":["[concat(variables('factoryId'), '/datasets/SAPHanaTable')]","[concat(variables('factoryId'), '/datasets/parquetOutput')]"]},{"name":"[concat(parameters('factoryName'), '/SAPHanaTable')]","type":"Microsoft.DataFactory/factories/datasets","apiVersion":"2018-06-01","properties":{"linkedServiceName":{"referenceName":"[parameters('SapHana1')]","type":"LinkedServiceReference"},"parameters":{"tableSchema":{"type":"string"},"tableName":{"type":"string"}},"annotations":[],"type":"SapHanaTable","schema":[],"typeProperties":{"schema":{"value":"@dataset().tableSchema","type":"Expression"},"table":{"value":"@dataset().tableName","type":"Expression"}}},"dependsOn":[]},{"name":"[concat(parameters('factoryName'), '/parquetOutput')]","type":"Microsoft.DataFactory/factories/datasets","apiVersion":"2018-06-01","properties":{"linkedServiceName":{"referenceName":"[parameters('AzureDataLakeStorage1')]","type":"LinkedServiceReference"},"parameters":{"tableName":{"type":"string"},"tableSchema":{"type":"string"},"fileSystem":{"type":"string"}},"annotations":[],"type":"Parquet","typeProperties":{"location":{"type":"AzureBlobFSLocation","fileName":{"value":"@concat(dataset().tableSchema,'.',dataset().fileSystem)","type":"Expression"},"fileSystem":{"value":"@dataset().fileSystem","type":"Expression"}},"compressionCodec":"snappy"},"schema":[]},"dependsOn":[]}]}